{% extends 'base.html' %}

{% load static %}

{% block contenido %}
      <main role="main" class="main-content">
        <div class="container-fluid">
          <div class="row justify-content-center">
            <div class="col-12 col-lg-10 col-xl-8">
              <h2 class="h3 mb-4 page-title">Configuraci√≥n de p√©rfil</h2>
              {% if messages %}
                  <div>
                    {% for message in messages %}
                        {% if message.tags == 'error' %}
                            <div class="alert alert-danger"> üö® {{ message }}</div>
                        {% else %}
                            <div class="alert alert-{{ message.tags }}"> {{ message }}</div>
                        {% endif %}
                    {% endfor %}
                  </div>
              {% endif %}

              <div class="my-4">

                <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link active" id="perfil-tab" data-toggle="tab" href="#perfil" role="tab" aria-controls="perfil" aria-selected="true">Perfil</a>
                  </li>
                   <li class="nav-item">
                    <a class="nav-link" id="cuenta-tab" data-toggle="tab" href="#cuenta" role="tab" aria-controls="cuenta" aria-selected="false">Cuenta</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="contrasena-tab" data-toggle="tab" href="#contrasena" role="tab" aria-controls="contrasena" aria-selected="false">Contrase√±a</a>
                  </li>
               
                </ul>

                <div class="tab-content" id="myTabContent">
                  <div class="tab-pane fade show active" id="perfil" role="tabpanel" aria-labelledby="perfil-tab">
                    <form method="POST" enctype="multipart/form-data">
                      <input type="hidden" name="form_type" value="perfil">
                      {% csrf_token %}
                      <div class="row mt-5 align-items-center">
                        <div class="col-12">
                          <h4 class="mb-1">{{ usuario.user.first_name }} {{ usuario.user.last_name }}</h4>
                        </div>
                        <div class="col-md-12 text-center mb-5">
                          <div class="avatar avatar-xl">
                            {% if usuario.foto %}
                              <img src="{{ usuario.foto.url }}" class="perfil-img rounded-circle">
                            {% else %}
                              <img src="{% static 'assets/avatars/default.png' %}" class="perfil-img rounded-circle">
                            {% endif %}
                          </div>
                        </div>
                        <div class="col">
                          <div class="row align-items-center">
                            <div class="col-7">
                              <input type="file" name="foto" id="foto" class="form-control mb-2" accept="image/*">
                            </div>
                            <div class="col-5">
                              <button type="submit" class="btn btn-primary">Cambiar foto</button>
                            </div>
                        </div>
                        
                        <!-- <div class="d-flex justify-content-between align-items-center"> 
                          <h4 class="mb-1">{{ usuario.user.first_name }} {{ usuario.user.last_name }}</h4>
                          <input type="file" name="foto" id="foto" class="form-control mb-2" accept="image/*">
                          <button type="submit" class="btn btn-primary">Cambiar foto</button>
                        </div> -->
                        </div>
                      </div>
                      <hr class="my-4">
                      <div class="form-row">
                        <div class="form-group col-md-6">
                          <label for="nombres">Nombres</label>
                          <input type="text" id="nombres" class="form-control" placeholder="Nombres" name="txtNombres" value="{{ usuario.user.first_name }}" required>
                        </div>
                        <div class="form-group col-md-6">
                          <label for="apellidos">Apellidos</label>
                          <input type="text" id="apellidos" class="form-control" placeholder="Apellidos" name="txtApellidos" value="{{ usuario.user.last_name }}" required>
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="inputEmail4">Email</label>
                        <input type="email" class="form-control" id="inputEmail4" placeholder="email" name="txtEmail" value="{{ usuario.user.email }}" required>
                      </div>
                      <div class="form-group">
                        <label for="inputNumTelf">Tel√©fono</label>
                        <input type="tel" class="form-control" id="inputNumTelf" placeholder="Tel√©fono" name="txtTelefono" value="{{ usuario.telefono }}" required>
                      </div>
                      <div class="form-group">
                        <label for="inputNumDoc">C√©dula</label>
                        <input type="text" class="form-control" id="inputNumDoc" placeholder="N√∫mero documento" name="txtNumDoc" value="{{ usuario.num_doc }}" required>
                      </div>
                      <button type="submit" class="btn btn-primary mt-3">Guardar cambios</button>
                    </form>
                  </div>

                  <div class="tab-pane fade" id="cuenta" role="tabpanel" aria-labelledby="cuenta-tab">
                    <form method="POST" class="mt-4">
                      <input type="hidden" name="form_type" value="cuenta">
                      {% csrf_token %}
                      <div class="form-group">
                        <label for="inputUsername">Usuario actual</label>
                        <input type="text" class="form-control" id="inputUsername" name="txtUsername" value="{{ usuario.user.username }}" disabled>
                      </div>
                      <div class="form-group">
                        <label for="NewUsername">Nueva usuario</label>
                        <input type="text" class="form-control" id="NewUsername" name="txtNewUsername" required> 
                      </div>
                      <div class="form-group">
                        <label for="inputPassword">Confirmar contrase√±a para guardar cambios</label>
                        <input type="password" class="form-control" id="txtPassword" name="txtPassword" required>
                      </div>
                  
                      <button type="submit" class="btn btn-primary">Guardar cambios</button>
                    </form>
                    
                  </div> 
      
                  <div class="tab-pane fade" id="contrasena" role="tabpanel" aria-labelledby="contrasena-tab">
                    <form method="POST" class="mt-4">
                      <input type="hidden" name="form_type" value="contrasena">
                      {% csrf_token %}
                        <div class="form-group">
                          <label for="inputPassword">Contrase√±a actual</label>
                          <input type="password" class="form-control" id="inputPassword" name="txtPassword" required>
                        </div>
                        <div class="form-group">
                          <label for="newPassword">Nueva Contrase√±a</label>
                          <input type="password" class="form-control" id="newPassword" name="txtNewPassword" required>
                        </div>
                        <div class="form-group">
                          <label for="confirmNewPassword">Confirmar nueva contrase√±a</label>
                          <input type="password" class="form-control" id="confirmNewPassword" name="txtConfNewPass" required>
                        </div>
                        
                        <div class="col-md-6">
                          <p class="mb-2">Requisitos de nueva contrase√±a</p>
                          <ul class="small text-muted pl-4 mb-4">
                            <li> Minimo 8 caracteres </li>
                            <li>Un caracter especial</li>
                            <li>Un n√∫mero</li>
                            <li>Una letra mayuscula</li>
                            <li>No debe ser similar a la contrase√±a anterior </li>
                          </ul>
                        </div>
                  
                      <button type="submit" class="btn btn-primary">Guardar dambios</button>
                    </form>
                  </div> <!-- /.tab-content -->
              </div> <!-- /.card-body -->
            </div> <!-- /.col-12 -->
          </div> <!-- .row -->
        </div> <!-- .container-fluid -->
      </main> <!-- main -->

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-56159088-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag()
      {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'UA-56159088-1');
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var hash = window.location.hash;
            if (hash) {
                var triggerEl = document.querySelector('a[href="' + hash + '"]');
                if (triggerEl) {
                    $(triggerEl).tab('show'); 
                }
            }
        });

        // Limpieza de hash (opcional)
        // if(window.location.hash) {
        //      history.replaceState('', document.title, window.location.pathname + window.location.search);
        // }
    </script>

  </body>
</html>
{% endblock %}